<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Neon Flappy – SpinnerRealYT Games</title>

    <link rel="icon" type="image/png" href="../Logo.png?v=2">
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>

    <style>
        :root {
            --bg: #020617;
            --card: rgba(15, 23, 42, 0.8);
            --accent: #38bdf8;
            --accent-glow: rgba(56, 189, 248, 0.4);
            --text: #f1f5f9;
            --danger: #fb7185;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow: hidden;
            user-select: none;
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #020617 70%);
        }

        header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px 5%; background: rgba(2, 6, 23, 0.9); backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(56, 189, 248, 0.2);
            position: sticky; top: 0; z-index: 1000;
        }

        .logo-area { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .logo-area img { height: 28px; }
        .logo-area span { font-weight: 800; font-size: 14px; background: linear-gradient(135deg, #38bdf8, #818cf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .user-status { text-align: right; line-height: 1.1; }
        #user-nick { font-weight: bold; color: var(--accent); font-size: 12px; text-transform: uppercase; }
        #sync-status { font-size: 9px; font-weight: bold; letter-spacing: 0.5px; }
        .synced { color: #4ade80; }
        .sync-err { color: var(--danger); }

        main { 
            max-width: 500px; margin: auto; padding: 15px 10px; 
            display: flex; flex-direction: column; align-items: center; 
        }

        .game-header {
            width: 320px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 15px;
            border: 1px solid rgba(56, 189, 248, 0.1);
        }

        .score-label {
            font-size: 22px;
            font-weight: 900;
            color: var(--text);
            letter-spacing: 1px;
            text-shadow: 0 0 10px var(--accent-glow);
        }
        #score-num { color: var(--accent); margin-left: 5px; }

        #game-container {
            position: relative;
            width: 320px;
            height: 480px;
            border-radius: 16px;
            overflow: hidden;
            border: 2px solid var(--accent);
            box-shadow: 0 0 25px rgba(56, 189, 248, 0.2);
        }

        canvas { background: #000; display: block; }

        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(2, 6, 23, 0.95);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; transition: opacity 0.3s;
        }

        .btn-lvl {
            background: rgba(56, 189, 248, 0.05);
            border: 1px solid var(--accent);
            color: var(--text);
            padding: 12px; margin: 5px;
            border-radius: 12px; cursor: pointer;
            width: 200px; font-weight: 800;
            transition: 0.2s;
        }
        .btn-lvl:hover { background: var(--accent); color: #000; box-shadow: 0 0 20px var(--accent); }

        footer { text-align: center; padding: 15px; opacity: 0.4; font-size: 10px; }
    </style>
</head>
<body>

<header>
    <div class="logo-area" onclick="location.href='../index.html'">
        <img src="../Logo.png" alt="Logo">
        <span>SPINNER GAMES</span>
    </div>
    <div class="user-status">
        <div id="user-nick">GOŚĆ</div>
        <div id="sync-status">Ładowanie...</div>
    </div>
</header>

<main>
    <div class="game-header">
        <div class="score-label">Score: <span id="score-num">0</span></div>
    </div>

    <div id="game-container">
        <canvas id="game" width="320" height="480"></canvas>
        
        <div id="overlay">
            <h1 style="margin-bottom:10px; letter-spacing: 2px;">NEON FLAPPY</h1>
            <div id="final-stats" style="margin-bottom: 20px; text-align: center; display:none;">
                <div style="font-size:12px; opacity:0.6">TWÓJ REKORD (BirdScore)</div>
                <div id="best-score" style="font-size:32px; font-weight:900; color:var(--accent)">0</div>
            </div>
            <button class="btn-lvl" onclick="initGame('amator')">AMATOR</button>
            <button class="btn-lvl" onclick="initGame('latwy')">ŁATWY</button>
            <button class="btn-lvl" onclick="initGame('sredni')">ŚREDNI</button>
            <button class="btn-lvl" onclick="initGame('trudny')">HARDCORE</button>
        </div>
    </div>
</main>

<footer>© 2026 SpinnerRealYT Games</footer>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyByk8GJSoTJ_bgPNjyKnKi3o30E8bQB-qo",
    authDomain: "spinnerrealyt-games.firebaseapp.com",
    databaseURL: "https://spinnerrealyt-games-default-rtdb.europe-west1.firebasedatabase.app/"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreNum = document.getElementById("score-num");
const overlay = document.getElementById("overlay");
const nickEl = document.getElementById("user-nick");
const syncEl = document.getElementById("sync-status");
const bestScoreEl = document.getElementById("best-score");

let bird = { x: 50, y: 240, w: 20, h: 20, dy: 0, rot: 0 };
let pipes = [];
let particles = [];
let score = 0;
let isDead = true;
let frame = 0;
let highScore = 0;
let currentUser = null;

const levels = {
    amator: { grav: 0.28, jump: -5.5, gap: 190, speed: 2, freq: 110 },
    latwy:  { grav: 0.38, jump: -6.5, gap: 160, speed: 2.5, freq: 100 },
    sredni: { grav: 0.48, jump: -7.5, gap: 140, speed: 3.2, freq: 90 },
    trudny: { grav: 0.62, jump: -8.8, gap: 120, speed: 4.2, freq: 75 }
};
let sets = levels.sredni;

// MONITOROWANIE KONTA I BIRD_SCORE
auth.onAuthStateChanged(user => {
    if(user) {
        currentUser = localStorage.getItem("sp_logged") || "Gracz";
        nickEl.textContent = currentUser;
        loadCloudScore();
    } else {
        syncEl.textContent = "LOCAL ONLY";
        highScore = localStorage.getItem("neon_flap_best") || 0;
        bestScoreEl.textContent = highScore;
    }
});

async function loadCloudScore() {
    try {
        const snap = await db.ref(`users/${currentUser.toLowerCase()}/BirdScore`).once('value');
        if(snap.exists()) {
            highScore = snap.val();
        } else {
            highScore = localStorage.getItem("neon_flap_best") || 0;
        }
        bestScoreEl.textContent = highScore;
        syncEl.textContent = "● SYNCED";
        syncEl.className = "synced";
    } catch(e) { 
        syncEl.textContent = "● ERROR"; 
        syncEl.className = "sync-err"; 
    }
}

async function updateBirdScore(s) {
    if(s > highScore) {
        highScore = s;
        localStorage.setItem("neon_flap_best", s);
        bestScoreEl.textContent = s;
        
        if(currentUser) {
            try {
                // Zmiana nazwy pola na BirdScore zgodnie z prośbą
                await db.ref(`users/${currentUser.toLowerCase()}/BirdScore`).set(s);
                syncEl.textContent = "● SYNCED";
            } catch(e) { syncEl.textContent = "● SYNC ERR"; }
        }
    }
}

// SILNIK
function createParticles(x, y) {
    for(let i=0; i<6; i++) {
        particles.push({ x, y, vx: (Math.random()-0.8)*3, vy: (Math.random()-0.5)*3, life: 1 });
    }
}

function initGame(lvl) {
    sets = levels[lvl];
    bird.y = 240; bird.dy = 0; pipes = []; particles = []; 
    score = 0; // Resetujemy wynik sesji
    frame = 0;
    scoreNum.textContent = "0";
    isDead = false;
    overlay.style.opacity = "0";
    setTimeout(() => {
        overlay.style.display = "none";
        document.getElementById("final-stats").style.display = "block";
    }, 300);
    gameLoop();
}

function jump() { 
    if(!isDead) {
        bird.dy = sets.jump;
        createParticles(bird.x, bird.y + 10);
    }
}

window.addEventListener("keydown", (e) => { if(e.code === "Space") { e.preventDefault(); jump(); }});
canvas.addEventListener("mousedown", jump);
canvas.addEventListener("touchstart", (e) => { e.preventDefault(); jump(); });

function gameLoop() {
    if(isDead) return;
    ctx.fillStyle = "#020617";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    particles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy; p.life -= 0.03;
        if(p.life <= 0) particles.splice(i, 1);
        ctx.fillStyle = `rgba(56, 189, 248, ${p.life})`;
        ctx.fillRect(p.x, p.y, 2, 2);
    });

    bird.dy += sets.grav;
    bird.y += bird.dy;
    bird.rot = Math.min(Math.PI/6, Math.max(-Math.PI/6, bird.dy * 0.1));

    ctx.save();
    ctx.translate(bird.x + 10, bird.y + 10);
    ctx.rotate(bird.rot);
    ctx.shadowBlur = 12; ctx.shadowColor = sets.speed > 3.5 ? "#fb7185" : "#38bdf8";
    ctx.fillStyle = ctx.shadowColor;
    ctx.fillRect(-10, -10, 20, 20);
    ctx.restore();

    if(frame % sets.freq === 0) {
        let gapPos = Math.random() * (canvas.height - sets.gap - 120) + 60;
        pipes.push({ x: canvas.width, y: gapPos, done: false });
    }

    pipes.forEach((p, i) => {
        p.x -= sets.speed;
        ctx.shadowBlur = 0;
        ctx.fillStyle = "#0f172a";
        ctx.strokeStyle = sets.speed > 3.5 ? "#fb7185" : "#38bdf8";
        ctx.lineWidth = 2;

        ctx.fillRect(p.x, 0, 50, p.y);
        ctx.strokeRect(p.x, -2, 50, p.y + 2);
        ctx.fillRect(p.x, p.y + sets.gap, 50, canvas.height);
        ctx.strokeRect(p.x, p.y + sets.gap, 50, canvas.height);

        // Kolizja
        if (bird.x < p.x + 50 && bird.x + 20 > p.x && (bird.y < p.y || bird.y + 20 > p.y + sets.gap)) gameOver();
        
        // PUNKTACJA: Za każdy minięty zestaw rur +1
        if (!p.done && p.x + 50 < bird.x) { 
            score++; 
            p.done = true; 
            scoreNum.textContent = score; 
        }
        if (p.x < -60) pipes.splice(i, 1);
    });

    if(bird.y + 20 > canvas.height || bird.y < 0) gameOver();
    frame++;
    requestAnimationFrame(gameLoop);
}

function gameOver() {
    isDead = true;
    updateBirdScore(score); // Zapisuje rekord do bazy jako BirdScore
    overlay.style.display = "flex";
    setTimeout(() => overlay.style.opacity = "1", 10);
}
</script>
</body>
</html>
