<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Saper ‚Äì SpinnerRealYT Games</title>

<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>

<style>
:root{
  --bg:#020617;
  --card:#0f172a;
  --accent:#38bdf8;
  --text:#e5e7eb;
  --cell-size: clamp(20px, 8vw, 45px);
}
*{box-sizing:border-box}
body{
  margin:0; font-family:Inter,sans-serif;
  background:radial-gradient(circle at top,#020617,#000);
  color:var(--text); user-select: none;
}
header{
  display:flex; align-items:center; justify-content: space-between; padding:15px 20px;
  background:rgba(15,23,42,.9); backdrop-filter:blur(10px);
  position:sticky; top:0; z-index:100; border-bottom: 1px solid rgba(56,189,248,0.2);
}
.user-tag { font-size: 12px; color: var(--accent); font-weight: bold; background: rgba(56,189,248,0.1); padding: 5px 10px; border-radius: 20px; border: 1px solid var(--accent); }
nav button{ background:none; border:none; color:var(--text); font-size:15px; cursor:pointer; }

main{ max-width: 600px; margin:auto; padding:10px; }
.card{ background:linear-gradient(180deg,#0f172a,#020617); border-radius:20px; padding:15px; box-shadow:0 20px 60px rgba(0,0,0,.6); }
h2{text-align:center; margin-top:0;}

#menu { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-bottom: 15px; font-size: 14px; }
input, button { background:#1e293b; color:white; border:1px solid #334155; border-radius:8px; padding:6px 10px; }
button { cursor:pointer; border-color: var(--accent); color: var(--accent); font-weight: bold;}

#game { display: grid; justify-content: center; margin: 10px auto; gap: 3px; background: rgba(0,0,0,0.2); padding: 5px; border-radius: 8px; width: fit-content; }
.cell { width: var(--cell-size); height: var(--cell-size); background: #334155; display: flex; justify-content: center; align-items: center; cursor: pointer; font-weight: 700; border-radius: 4px; font-size: calc(var(--cell-size) * 0.5); }
.open { background:#e5e7eb; color:#020617; }
.mine { background:#dc2626; color:white; }
.flagged { background:#facc15; color:#020617; }

.number1{color:#2563eb} .number2{color:#16a34a} .number3{color:#dc2626}
#controls-mobile { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
.btn-mode { padding: 12px 20px; flex: 1; max-width: 150px; }
.active-mode { background: var(--accent); color: #020617; }
</style>
</head>
<body>

<header>
  <nav><button onclick="location.href='../index.html'">‚¨Ö Wstecz</button></nav>
  <div id="user-info" class="user-tag">Go≈õƒá</div>
</header>

<main>
  <div class="card">
    <h2>üí£ Saper</h2>
    <div id="menu">
      Size: <input type="number" id="grid-size" value="9" min="5" max="15" style="width:45px">
      Bombs: <input type="number" id="bomb-count" value="10" min="5" style="width:45px">
      <button id="start-btn">Start</button>
      <div id="info">Flags: 0 / 10</div>
    </div>

    <div id="game"></div>

    <div id="controls-mobile">
      <button id="btn-open" class="btn-mode active-mode">Odkryj</button>
      <button id="btn-flag" class="btn-mode">Flaga</button>
    </div>
    
    <div id="points-info" style="text-align:center; margin-top:10px; font-weight: bold; color: var(--accent); font-size: 1.2rem;">Points: 0</div>
  </div>
</main>

<script>
(() => {
    // --- PE≈ÅNA KONFIGURACJA FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyByk8GJSoTJ_bgPNjyKnKi3o30E8bQB-qo",
        authDomain: "spinnerrealyt-games.firebaseapp.com",
        databaseURL: "https://spinnerrealyt-games-default-rtdb.europe-west1.firebasedatabase.app/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const loggedUser = localStorage.getItem("sp_logged");

    // Pokazywanie nazwy konta
    if(loggedUser) {
        document.getElementById('user-info').textContent = "Gracz: " + loggedUser.toUpperCase();
    }

    let ROWS=9, COLS=9, MINES_COUNT=10;
    const gameEl=document.getElementById('game'), infoEl=document.getElementById('info');
    const pointsInfoEl=document.getElementById('points-info');
    let cells=[], minePositions=new Set(), flags=new Set(), opened=new Set();
    let gameOver=false, flagMode=false, firstClick=true, points=0;

    // Pobieranie punkt√≥w
    async function loadData() {
        if(!loggedUser) return;
        const snap = await db.ref('users_map/' + loggedUser).once('value');
        if(snap.exists()) {
            points = snap.val().points || 0;
            pointsInfoEl.textContent = `Points: ${points}`;
        }
    }

    // Zapisywanie punkt√≥w
    async function saveData() {
        if(!loggedUser) return;
        await db.ref('users_map/' + loggedUser).update({ points: points });
    }

    function createGrid(){
        gameEl.innerHTML=''; cells=[];
        gameEl.style.gridTemplateColumns = `repeat(${COLS}, var(--cell-size))`;
        for(let i=0; i<ROWS*COLS; i++){
            const c=document.createElement('div');
            c.className='cell';
            c.onclick = () => flagMode ? toggleFlag(i) : openCell(i);
            c.oncontextmenu = (e) => { e.preventDefault(); toggleFlag(i); };
            gameEl.appendChild(c);
            cells.push(c);
        }
    }

    function placeMines(firstIdx){
        minePositions.clear();
        while(minePositions.size < MINES_COUNT){
            let p = Math.floor(Math.random()*ROWS*COLS);
            if(p !== firstIdx) minePositions.add(p);
        }
    }

    function openCell(i){
        if(gameOver || opened.has(i) || flags.has(i)) return;
        if(firstClick){ firstClick=false; placeMines(i); }
        opened.add(i);
        const c=cells[i]; c.classList.add('open');
        if(minePositions.has(i)){
            c.textContent='üí£'; c.classList.add('mine');
            gameOver=true; infoEl.textContent='üí• BUM!';
            return;
        }
        let n = 0;
        const r=Math.floor(i/COLS), col=i%COLS;
        for(let dr=-1; dr<=1; dr++) for(let dc=-1; dc<=1; dc++){
            let nr=r+dr, nc=col+dc;
            if(nr>=0 && nr<ROWS && nc>=0 && nc<COLS && minePositions.has(nr*COLS+nc)) n++;
        }
        if(n > 0){ c.textContent = n; c.classList.add(`number${n}`); }
        else { /* proste auto-reveal mo≈ºna dodaƒá tutaj */ }
        
        if(opened.size === ROWS*COLS - MINES_COUNT) {
            gameOver=true; infoEl.textContent='üéâ WIN!';
            if(ROWS === 9) {
                points += 1;
                saveData();
                alert("Zdoby≈Çe≈õ 1 punkt!");
            }
            pointsInfoEl.textContent = `Points: ${points}`;
        }
    }

    function toggleFlag(i){
        if(gameOver || opened.has(i)) return;
        if(flags.has(i)){ flags.delete(i); cells[i].textContent=''; cells[i].classList.remove('flagged'); }
        else { flags.add(i); cells[i].textContent='üö©'; cells[i].classList.add('flagged'); }
        infoEl.textContent=`Flags: ${flags.size} / ${MINES_COUNT}`;
    }

    document.getElementById('start-btn').onclick = () => {
        ROWS = COLS = parseInt(document.getElementById('grid-size').value);
        MINES_COUNT = parseInt(document.getElementById('bomb-count').value);
        gameOver=false; firstClick=true; flags.clear(); opened.clear();
        createGrid();
    };

    document.getElementById('btn-open').onclick = () => { flagMode=false; document.getElementById('btn-open').classList.add('active-mode'); document.getElementById('btn-flag').classList.remove('active-mode'); };
    document.getElementById('btn-flag').onclick = () => { flagMode=true; document.getElementById('btn-flag').classList.add('active-mode'); document.getElementById('btn-open').classList.remove('active-mode'); };

    loadData();
    createGrid();
})();
</script>
</body>
</html>
