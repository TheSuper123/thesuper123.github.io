<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Neon Tree Incremental – SpinnerRealYT Games</title>
<link rel="icon" href="../Logo.png">
<style>
:root{ --bg:#020617; --card:#0f172a; --accent:#38bdf8; --text:#e5e7eb; --gold:#facc15; }
*{box-sizing:border-box}
body{
    margin:0; font-family:Inter,sans-serif; background:var(--bg); color:var(--text);
    overflow: hidden; touch-action: none;
}
header{
    display:flex; align-items:center; justify-content: space-between;
    padding:10px 20px; background:rgba(15,23,42,.9); backdrop-filter:blur(10px);
}
header img{height:30px}
main{ display: flex; flex-direction: column; align-items: center; padding: 20px; }

#game-viewport {
    position: relative; width: 500px; height: 500px; background: #000;
    border: 2px solid var(--accent); border-radius: 15px; overflow: hidden;
    box-shadow: 0 0 20px rgba(56, 189, 248, 0.2);
}
#player {
    position: absolute; width: 22px; height: 22px; background: var(--accent);
    box-shadow: 0 0 15px var(--accent); border-radius: 6px; z-index: 10;
}
.node {
    position: absolute; width: 80px; height: 80px; background: var(--card);
    border: 2px solid #334155; border-radius: 12px; display: flex;
    flex-direction: column; align-items: center; justify-content: center;
    font-size: 11px; text-align: center; padding: 5px; transition: 0.3s;
}
.node.unlocked { border-color: var(--gold); background: rgba(250, 204, 21, 0.05); }
.node.can-afford { border-color: #4ade80; transform: scale(1.05); }

#ui-overlay { margin-bottom: 15px; text-align: center; }
.currency { font-size: 28px; font-weight: 800; color: var(--accent); text-shadow: 0 0 10px rgba(56, 189, 248, 0.5); }
.pps-info { opacity: 0.6; font-size: 14px; }
</style>
</head>
<body>

<header>
    <img src="../Logo.png">
    <div id="user-display">Gracz: Gość</div>
    <button onclick="location.href='../index.html'" style="background:none; border:1px solid var(--accent); color:var(--accent); padding:5px 15px; border-radius:8px; cursor:pointer;">Menu</button>
</header>

<main>
    <div id="ui-overlay">
        <div class="currency"><span id="points">0</span> Δ</div>
        <div class="pps-info">Zysk: <span id="pps">0</span>/s</div>
    </div>

    <div id="game-viewport">
        <div id="player"></div>
    </div>
    
    <p style="font-size: 12px; opacity: 0.5; margin-top: 15px;">Poruszaj się: **WSAD / Strzałki** | Dotknij bloku, aby ulepszyć</p>
</main>

<script>
// Klucz zapisu powiązany z zalogowanym użytkownikiem
const currentUser = localStorage.getItem("sp_logged") || "guest";
const SAVE_KEY = `sp_save_incremental_${currentUser}`;

let state = {
    points: 0,
    pps: 1,
    player: { x: 240, y: 240, speed: 4.5 },
    upgrades: {
        gen1: { level: 0, cost: 10, ppsAdd: 1, x: 80, y: 80, name: "Generator I" },
        gen2: { level: 0, cost: 150, ppsAdd: 8, x: 340, y: 80, name: "Generator II" },
        speed: { level: 0, cost: 50, ppsAdd: 0, x: 80, y: 340, name: "Prędkość" },
        prestige: { level: 0, cost: 1000, ppsAdd: 50, x: 340, y: 340, name: "Difficulty Up" }
    }
};

const keys = {};
window.onkeydown = e => keys[e.key.toLowerCase()] = true;
window.onkeyup = e => keys[e.key.toLowerCase()] = false;

function loadGame() {
    const saved = localStorage.getItem(SAVE_KEY);
    if(saved) {
        const parsed = JSON.parse(saved);
        state = {...state, ...parsed};
    }
    document.getElementById('user-display').textContent = `Gracz: ${currentUser}`;
}

function saveGame() {
    localStorage.setItem(SAVE_KEY, JSON.stringify(state));
}

function init() {
    loadGame();
    const viewport = document.getElementById('game-viewport');
    for (let id in state.upgrades) {
        const u = state.upgrades[id];
        const div = document.createElement('div');
        div.className = 'node';
        div.id = `node-${id}`;
        div.style.left = u.x + 'px';
        div.style.top = u.y + 'px';
        viewport.appendChild(div);
    }
    setInterval(saveGame, 5000); // Autozapis co 5 sekund
    requestAnimationFrame(gameLoop);
}

function gameLoop() {
    // Ruch gracza
    let dx = 0, dy = 0;
    if (keys['w'] || keys['arrowup']) dy -= state.player.speed;
    if (keys['s'] || keys['arrowdown']) dy += state.player.speed;
    if (keys['a'] || keys['arrowleft']) dx -= state.player.speed;
    if (keys['d'] || keys['arrowright']) dx += state.player.speed;

    state.player.x = Math.max(0, Math.min(478, state.player.x + dx));
    state.player.y = Math.max(0, Math.min(478, state.player.y + dy));

    const pEl = document.getElementById('player');
    pEl.style.left = state.player.x + 'px';
    pEl.style.top = state.player.y + 'px';

    // Kolizje i kupowanie
    for (let id in state.upgrades) {
        const u = state.upgrades[id];
        // Sprawdzanie czy środek gracza jest wewnątrz kwadratu ulepszenia
        if (state.player.x + 11 > u.x && state.player.x + 11 < u.x + 80 &&
            state.player.y + 11 > u.y && state.player.y + 11 < u.y + 80) {
            if (state.points >= u.cost) {
                buyUpgrade(id);
            }
        }
    }

    // Punkty PPS
    state.points += state.pps / 60;
    updateUI();
    requestAnimationFrame(gameLoop);
}

function buyUpgrade(id) {
    const u = state.upgrades[id];
    state.points -= u.cost;
    u.level++;
    
    if(id === 'speed') state.player.speed += 0.4;
    else if(id === 'prestige') {
        state.pps *= 1.5;
        document.getElementById('game-viewport').style.borderColor = '#c084fc';
    } else {
        state.pps += u.ppsAdd;
    }

    u.cost = Math.floor(u.cost * 1.6);
    saveGame(); // Zapis po zakupie
}

function updateUI() {
    document.getElementById('points').textContent = Math.floor(state.points).toLocaleString();
    document.getElementById('pps').textContent = state.pps.toFixed(1);

    for (let id in state.upgrades) {
        const u = state.upgrades[id];
        const el = document.getElementById(`node-${id}`);
        if(el) {
            el.innerHTML = `<strong>${u.name}</strong><br>Lv. ${u.level}<br><span style="color:${state.points >= u.cost ? '#4ade80' : '#f87171'}">${u.cost} Δ</span>`;
            el.className = 'node' + (u.level > 0 ? ' unlocked' : '') + (state.points >= u.cost ? ' can-afford' : '');
        }
    }
}

init();
</script>
</body>
</html>
