<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Saper - SpinnerRealYT Games</title>
<style>
  body { background: #222; color: white; font-family: sans-serif; text-align: center; margin: 0; overflow-x: hidden; }
  #menu { padding: 10px; background: #333; }
  input { width: 60px; padding: 3px; margin: 3px; text-align: center; }
  button { padding: 5px 10px; margin: 3px; font-size: 14px; cursor: pointer; }
  #info { margin-top: 5px; }
  #game { 
    display: grid; 
    justify-content: center; 
    margin: 10px auto; 
    gap: 1px; 
    background: #555; 
    touch-action: none; 
  }
  .cell { background: #888; display: flex; justify-content: center; align-items: center; cursor: pointer; user-select: none; }
  .open { background: #ccc; }
  .mine { background: #f00; color: white; }
  .flagged { background: #ff0; }
  .number1 { color: blue; } .number2 { color: green; } .number3 { color: red; } .number4 { color: navy; }
  .number5 { color: brown; } .number6 { color: teal; } .number7 { color: black; } .number8 { color: gray; }
  #controls { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; }
  a.back-btn {
    display: inline-block;
    margin-top: 15px;
    padding: 8px 15px;
    font-size: 16px;
    background: #6a0dad;
    color: white;
    text-decoration: none;
    border-radius: 8px;
  }
  a.back-btn:hover { background: #9b59b6; }
  img.logo { width: 100px; display: block; margin: 15px auto; }
</style>
</head>
<body>

<img src="Logo.png" alt="Logo" class="logo">

<div id="menu">
  Rozmiar: <input type="number" id="grid-size" value="9" min="5" max="100">
  Bomby: <input type="number" id="bomb-count" value="10" min="5">
  <button id="start-btn">Start Game</button>
  <button id="reset-btn">Reset</button>
  <button id="mode-toggle">Flag Mode: OFF</button>
  <button id="hint-btn">Hint (1 free)</button>
  <div id="info">Flags: 0 / 0</div>
  <div id="points-info">Points: 0 | Hints: 1</div>
</div>

<div id="game"></div>

<div id="controls">
  <button id="btn-open">OtwÃ³rz</button>
  <button id="btn-flag">Flaga</button>
</div>

<a href="index.html" class="back-btn">â¬… PowrÃ³t do Menu</a>

<script>
(() => {
  let ROWS = 9, COLS = 9, MINES_COUNT = 10;
  const gameEl = document.getElementById('game');
  const infoEl = document.getElementById('info');
  const modeToggleBtn = document.getElementById('mode-toggle');
  const resetBtn = document.getElementById('reset-btn');
  const startBtn = document.getElementById('start-btn');
  const gridSizeInput = document.getElementById('grid-size');
  const bombCountInput = document.getElementById('bomb-count');
  const btnOpen = document.getElementById('btn-open');
  const btnFlag = document.getElementById('btn-flag');
  const hintBtn = document.getElementById('hint-btn');
  const pointsInfoEl = document.getElementById('points-info');

  let cells = [];
  let minePositions = new Set();
  let flags = new Set();
  let opened = new Set();
  let gameOver = false;
  let flagMode = false;
  let firstClick = true;
  let points = 0;
  let hints = 1;

  function updatePointsInfo() {
    pointsInfoEl.textContent = `Points: ${points} | Hints: ${hints}`;
  }

  function createGrid() {
    gameEl.innerHTML = '';
    cells = [];
    const availableWidth = window.innerWidth - 20;
    const availableHeight = window.innerHeight - 200;
    const cellSize = Math.floor(Math.min(availableWidth / COLS, availableHeight / ROWS));

    gameEl.style.gridTemplateColumns = `repeat(${COLS}, ${cellSize}px)`;
    gameEl.style.gridTemplateRows = `repeat(${ROWS}, ${cellSize}px)`;

    for(let i=0; i<ROWS*COLS; i++){
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.index = i;
      cell.style.fontSize = `${Math.floor(cellSize * 0.6)}px`;
      cell.style.width = `${cellSize}px`;
      cell.style.height = `${cellSize}px`;
      gameEl.appendChild(cell);
      cells.push(cell);
    }
  }

  function placeMines(firstIndex) {
    minePositions.clear();
    while(minePositions.size < MINES_COUNT){
      const pos = Math.floor(Math.random() * ROWS * COLS);
      if(pos === firstIndex || neighbors(firstIndex).includes(pos)) continue;
      minePositions.add(pos);
    }
  }

  function neighbors(index) {
    const n = [];
    const r = Math.floor(index / COLS);
    const c = index % COLS;
    for(let dr=-1; dr<=1; dr++){
      for(let dc=-1; dc<=1; dc++){
        if(dr===0 && dc===0) continue;
        const nr = r + dr;
        const nc = c + dc;
        if(nr>=0 && nr<ROWS && nc>=0 && nc<COLS){
          n.push(nr*COLS + nc);
        }
      }
    }
    return n;
  }

  function countMines(index) {
    return neighbors(index).filter(n => minePositions.has(n)).length;
  }

  function openCell(index) {
    if(gameOver || opened.has(index) || flags.has(index)) return;
    if(firstClick) { firstClick = false; placeMines(index); }
    opened.add(index);
    const cell = cells[index];
    if(minePositions.has(index)){
      cell.classList.add('mine', 'open');
      cell.textContent = "ðŸ’£";
      return loseGame();
    }
    const count = countMines(index);
    cell.classList.add('open');
    if(count > 0){
      cell.textContent = count;
      cell.classList.add(`number${count}`);
    } else {
      neighbors(index).forEach(openCell);
    }
    checkWin();
  }

  function toggleFlag(index) {
    if(gameOver || opened.has(index)) return;
    const cell = cells[index];
    if(flags.has(index)){
      flags.delete(index);
      cell.classList.remove('flagged');
      cell.textContent = '';
    } else {
      if(flags.size >= MINES_COUNT) return;
      flags.add(index);
      cell.classList.add('flagged');
      cell.textContent = "ðŸš©";
    }
    updateFlagsInfo();
    checkWin();
  }

  function updateFlagsInfo(){
    infoEl.textContent = `Flags: ${flags.size} / ${MINES_COUNT}`;
  }

  function checkWin(){
    if(gameOver) return;
    if(opened.size === ROWS*COLS - MINES_COUNT){
      winGame();
    }
  }

  function loseGame(){
    gameOver = true;
    infoEl.textContent = "ðŸ’¥ Game Over!";
    minePositions.forEach(i => {
      if(!opened.has(i)){
        const cell = cells[i];
        cell.classList.add('mine', 'open');
        cell.textContent = "ðŸ’£";
      }
    });
  }

  function winGame(){
    gameOver = true;
    infoEl.textContent = "ðŸŽ‰ You Win!";
    points++;
    updatePointsInfo();
  }

  function resetGame(){
    gameOver = false;
    firstClick = true;
    flags.clear();
    opened.clear();
    updateFlagsInfo();
    createGrid();
    setupEvents();
    updatePointsInfo();
  }

  function useHint() {
    if (hints <= 0) { alert("Brak hintÃ³w!"); return; }
    hints--;
    const safeCells = cells
      .map((cell, i) => i)
      .filter(i => !minePositions.has(i) && !opened.has(i) && !flags.has(i));
    if(safeCells.length===0) return;
    const randomIndex = safeCells[Math.floor(Math.random() * safeCells.length)];
    openCell(randomIndex);
    updatePointsInfo();
  }

  function buyHint() {
    if(points<=0){ alert("Nie masz punktÃ³w!"); return; }
    points--; hints++;
    updatePointsInfo();
  }

  hintBtn.onclick = () => { if(hints>0) useHint(); else { if(confirm("Kup hint za 1 punkt?")) buyHint(); } };

  function setupEvents(){
    cells.forEach(cell => {
      cell.onclick = () => { const index = +cell.dataset.index; flagMode ? toggleFlag(index) : openCell(index); };
      cell.oncontextmenu = e => { e.preventDefault(); toggleFlag(+cell.dataset.index); };
    });
  }

  gridSizeInput.addEventListener('input', () => {
    const size = Math.max(5, Math.min(100, +gridSizeInput.value));
    const maxBombs = Math.floor((size*size)/2);
    bombCountInput.min = 5;
    bombCountInput.max = maxBombs;
    if(+bombCountInput.value>maxBombs) bombCountInput.value = maxBombs;
  });

  startBtn.onclick = () => {
    const size = Math.max(5, Math.min(100, +gridSizeInput.value));
    const maxBombs = Math.floor((size*size)/2);
    const bombs = +bombCountInput.value;
    if(bombs<5 || bombs>maxBombs){ alert("Za duÅ¼o bomb!"); return; }
    ROWS = COLS = size;
    MINES_COUNT = bombs;
    resetGame();
  };

  modeToggleBtn.onclick = () => {
    flagMode = !flagMode;
    modeToggleBtn.textContent = `Flag Mode: ${flagMode?'ON':'OFF'}`;
  };

  resetBtn.onclick = resetGame;
  btnOpen.onclick = () => flagMode=false;
  btnFlag.onclick = () => flagMode=true;

  resetGame();
})();
</script>

</body>
</html>
